<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ì§€ê°‘ ì—°ê²°</title>
  </head>
  <body style="text-align:center; padding-top:50px; font-family:sans-serif;">
    <h2>Web3 ì§€ê°‘ ì—°ê²°</h2>
    <button id="connect-button" style="font-size:20px;padding:10px 30px;">
      ì§€ê°‘ ì—°ê²° ë° ì„œëª…
    </button>

    <div id="result-container" style="margin-top:30px;"></div>

    <script src="https://leeeunsuuu.github.io/wallet-dapp/ethers.umd.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const btn = document.getElementById("connect-button");
        const result = document.getElementById("result-container");

        if (!window.ethers) {
          alert("ethers.js ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          return;
        }

        function encodeBase64(obj) {
          return btoa(unescape(encodeURIComponent(JSON.stringify(obj))));
        }

        btn.addEventListener("click", async () => {
          try {
            if (!window.ethereum) {
              alert("MetaMask ì•±ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì´ í˜ì´ì§€ë¥¼ ì—´ì–´ì£¼ì„¸ìš”.");
              return;
            }

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            const signer = provider.getSigner();
            const address = await signer.getAddress();
            const message = "ì´ ê³„ì•½ì„œì— ë™ì˜í•˜ì—¬ ì„œëª…í•©ë‹ˆë‹¤.";
            const signature = await signer.signMessage(message);

            const combined = { address, sig: signature };
            const encoded = encodeURIComponent(encodeBase64(combined));
            const deeplink = `anb://172.30.1.78:8081?data=${encoded}`;

            console.log("ğŸ“¬ combined:", combined);
            console.log("ğŸ“¬ encoded:", encoded);
            console.log("ğŸ“¬ deeplink:", deeplink);

            result.innerHTML = `
              <p style="font-size:16px;">ì„œëª…ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤.<br>ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì•±ìœ¼ë¡œ ëŒì•„ê°€ ì£¼ì„¸ìš”.</p>
              <a href="${deeplink}" style="display:inline-block;margin-top:10px;font-size:18px;padding:10px 20px;background:#007aff;color:white;border-radius:6px;text-decoration:none;">
                ğŸ‘‰ ì•±ìœ¼ë¡œ ëŒì•„ê°€ê¸°
              </a>
              <p style="margin-top:20px;font-size:14px;color:#555;">
                â€» ì•±ì´ ìë™ìœ¼ë¡œ ì—´ë¦¬ì§€ ì•Šìœ¼ë©´ í™ˆ í™”ë©´ìœ¼ë¡œ ë‚˜ê°€ ì§ì ‘ ì‹¤í–‰í•´ ì£¼ì„¸ìš”.
              </p>
              <p style="font-size:12px;margin-top:20px;color:#333;">
                ë”¥ë§í¬ ì£¼ì†Œ:<br/>
                <code>${deeplink}</code>
              </p>
            `;
          } catch (err) {
            alert("ì˜¤ë¥˜ ë°œìƒ: " + err.message);
            console.error(err);
          }
        });
      });
    </script>
  </body>
</html>
