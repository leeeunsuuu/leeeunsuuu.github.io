<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ì§€ê°‘ ì—°ê²°</title>
  </head>
  <body style="text-align:center; padding-top:50px;">
    <h2>Web3 ì§€ê°‘ ì—°ê²°</h2>
    <button id="connect-button" style="font-size:20px;padding:10px 30px;">
      ì§€ê°‘ ì—°ê²° ë° ì„œëª…
    </button>

    <script src="https://leeeunsuuu.github.io/wallet-dapp/ethers.umd.min.js"></script>

    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const btn = document.getElementById("connect-button");

        if (!window.ethers) {
          alert("ethers.js ë¡œë“œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.");
          return;
        }

        btn.addEventListener("click", async () => {
          try {
            if (!window.ethereum) {
              alert("MetaMask ì•±ì˜ ë¸Œë¼ìš°ì €ì—ì„œ ì´ í˜ì´ì§€ë¥¼ ì—´ì–´ì£¼ì„¸ìš”.");
              return;
            }

            const provider = new ethers.providers.Web3Provider(window.ethereum);
            await provider.send("eth_requestAccounts", []);
            const signer = provider.getSigner();
            const address = await signer.getAddress();
            const message = "ì´ ê³„ì•½ì„œì— ë™ì˜í•˜ì—¬ ì„œëª…í•©ë‹ˆë‹¤.";
            const signature = await signer.signMessage(message);

            alert("ì„œëª… ì™„ë£Œ!\nì£¼ì†Œ: " + address + "\nì„œëª…: " + signature);

            // âœ… ë”¥ë§í¬ ìƒì„±
            const encodedAddress = encodeURIComponent(address);
            const encodedSig = encodeURIComponent(signature);
            const deeplink = `anb://signature?address=${encodedAddress}&sig=${encodedSig}`;

            // âœ… ì•ˆë‚´ ë¬¸êµ¬
            const info = document.createElement("p");
            info.innerText = "ì•±ìœ¼ë¡œ ëŒì•„ê°€ë ¤ë©´ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ì£¼ì„¸ìš”.";
            info.style = "margin-top:20px;font-size:16px;";
            document.body.appendChild(info);

            // âœ… ë§í¬ë¡œ ì•± ì‹¤í–‰ (ë¸Œë¼ìš°ì € í˜¸í™˜ì„± â†‘)
            const link = document.createElement("a");
            link.href = deeplink;
            link.innerText = "ğŸ‘‰ ì•±ìœ¼ë¡œ ëŒì•„ê°€ê¸°";
            link.style =
              "display:inline-block;margin-top:10px;font-size:18px;padding:10px 20px;background:#007aff;color:white;border-radius:6px;text-decoration:none;";
            document.body.appendChild(link);
          } catch (err) {
            alert("ì˜¤ë¥˜ ë°œìƒ: " + err.message);
            console.error(err);
          }
        });
      });
    </script>
  </body>
</html>
